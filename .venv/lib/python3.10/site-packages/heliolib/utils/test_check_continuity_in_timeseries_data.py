import pandas as pd
from .check_continuity_of_timestamps import check_continuity_of_timeseries_index


def test_check_continuity_in_timeseries_data():
    data = pd.DataFrame(
        [1, 2, 3, 7, 8, 10, 12, 13],
        index=pd.to_datetime(
            [
                "2022-01-01 00:00",
                "2022-01-01 00:01",
                "2022-01-01 00:02",
                "2022-01-01 00:03",
                "2022-01-01 00:05",
                "2022-01-01 00:08",
                "2022-01-01 00:09",
                "2022-01-01 00:10",
            ]
        ),
    )
    minimum_data_points = 3
    data_freq = 1
    (
        continuous,
        timestamps_to_keep,
        continuous_indices,
    ) = check_continuity_of_timeseries_index(data, minimum_data_points, data_freq)
    assert continuous == [True, True, False, False, False, True]
    assert timestamps_to_keep.equals(
        pd.DataFrame(
            [1, 2, 3, 7, 10, 12, 13],
            index=pd.to_datetime(
                [
                    "2022-01-01 00:00",
                    "2022-01-01 00:01",
                    "2022-01-01 00:02",
                    "2022-01-01 00:03",
                    "2022-01-01 00:08",
                    "2022-01-01 00:09",
                    "2022-01-01 00:10",
                ]
            ),
        )
    )
    assert continuous_indices == [
        [
            pd.Timestamp("2022-01-01 00:00"),
            pd.Timestamp("2022-01-01 00:01"),
            pd.Timestamp("2022-01-01 00:02"),
            pd.Timestamp("2022-01-01 00:03"),
        ],
        [
            pd.Timestamp("2022-01-01 00:08"),
            pd.Timestamp("2022-01-01 00:09"),
            pd.Timestamp("2022-01-01 00:10"),
        ],
    ]
