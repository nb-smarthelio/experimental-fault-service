import pytest
import pandas as pd

from heliolib.utils.time_zone_info_handler import TimeZoneInfoHandler


def prepare_valid_dataframe_with_naive_index():
    data_frame = pd.DataFrame(index=pd.date_range("2021-01-01", "2021-01-02", freq="H"))
    return data_frame


def prepare_valid_dataframe_with_aware_index():
    data_frame = pd.DataFrame(
        index=pd.date_range("2021-01-01", "2021-01-02", freq="H", tz="UTC")
    )
    return data_frame


def test_time_zone_awareness_validation_fails_with_naive_index_when_aware_is_expected():
    time_zone_naive_dataframe = prepare_valid_dataframe_with_naive_index()
    time_zone_handler = TimeZoneInfoHandler()
    with pytest.raises(ValueError) as e_info:
        time_zone_handler.validate_if_index_is_time_zone_aware(
            expect_aware=True, dataframe=time_zone_naive_dataframe
        )
    assert str(e_info.value) == (
        "Datetime index is not timezone aware. Please ensure the index is timezone aware "
        "before proceeding."
    )


def test_time_zone_awareness_validation_fails_with_aware_index_when_unaware_is_expected():
    time_zone_aware_dataframe = prepare_valid_dataframe_with_aware_index()
    time_zone_handler = TimeZoneInfoHandler()
    with pytest.raises(ValueError) as e_info:
        time_zone_handler.validate_if_index_is_time_zone_aware(
            expect_aware=False, dataframe=time_zone_aware_dataframe
        )
    assert str(e_info.value) == "Datetime index is already timezone aware."
